!**************************************************************************
!  HALL C  BEAMLINE
!**************************************************************************
!As of 11/10/2011 
!
! 2/12/2012 B.Waidyawansa : Rearranged 3c16 wires to fix the wire mixup done at bpm can.
!
! 2013-03-11 M. McHugh : Created new target BPM containing 3h04 with name qwk_target_plus4.
!
ROC=1
Bank=0x102
!same sample size for ADCs in a given bank
!sample_size=480
!for 960Hz
sample_size=464  
!
!
! module.type, module.num  chan.num, det.type, det.name
!
!
!ADC0, Slot 18, Serial Number 13, Address 0x7B
   VQWK, 0, 2,  bcm,  QWK_BCMGL1
   VQWK, 0, 3,  bcm,  QWK_BCMGL2
   VQWK, 0, 4,  bcm,  QWK_BCM5
   VQWK, 0, 5,  bcm,  QWK_BCM6
   VQWK, 0, 6,  bcm,  QWK_BCM7 
   VQWK, 0, 7,  bcm,  QWK_BCM8

!ADC1, Slot 4,  Serial Number 26, Address 0x7C
   VQWK, 1, 0,  bpmstripline,  QWK_BPM3H04XP
   VQWK, 1, 1,  bpmstripline,  QWK_BPM3H04XM
   VQWK, 1, 2,  bpmstripline,  QWK_BPM3H04YP
   VQWK, 1, 3,  bpmstripline,  QWK_BPM3H04YM
   VQWK, 1, 4,  bpmstripline,  QWK_BPM3H07AXP
   VQWK, 1, 5,  bpmstripline,  QWK_BPM3H07AXM
   VQWK, 1, 6,  bpmstripline,  QWK_BPM3H07AYP
   VQWK, 1, 7,  bpmstripline,  QWK_BPM3H07AYM

!ADC2, Slot 5,  Serial Number 22, Address 0x7D
   VQWK, 2, 0,  bpmstripline,  QWK_BPM3H07BXP
   VQWK, 2, 1,  bpmstripline,  QWK_BPM3H07BXM
   VQWK, 2, 2,  bpmstripline,  QWK_BPM3H07BYP
   VQWK, 2, 3,  bpmstripline,  QWK_BPM3H07BYM
   VQWK, 2, 4,  bpmstripline,  QWK_BPM3H07CXP
   VQWK, 2, 5,  bpmstripline,  QWK_BPM3H07CXM
   VQWK, 2, 6,  bpmstripline,  QWK_BPM3H07CYP
   VQWK, 2, 7,  bpmstripline,  QWK_BPM3H07CYM

!ADC3, Slot 6,  Serial Number 08, Address 0x7E
   VQWK, 3, 0,  bpmstripline,  QWK_BPM3H08XP
   VQWK, 3, 1,  bpmstripline,  QWK_BPM3H08XM
   VQWK, 3, 2,  bpmstripline,  QWK_BPM3H08YP
   VQWK, 3, 3,  bpmstripline,  QWK_BPM3H08YM
   VQWK, 3, 4,  bpmstripline,  QWK_BPM3H09XP
   VQWK, 3, 5,  bpmstripline,  QWK_BPM3H09XM
   VQWK, 3, 6,  bpmstripline,  QWK_BPM3H09YP
   VQWK, 3, 7,  bpmstripline,  QWK_BPM3H09YM

!ADC4, Slot 7,  Serial Number 37, Address 0x7F
   VQWK, 4, 0,  bpmstripline,  QWK_BPM3H09BXP	
   VQWK, 4, 1,  bpmstripline,  QWK_BPM3H09BXM
   VQWK, 4, 2,  bpmstripline,  QWK_BPM3H09BYP
   VQWK, 4, 3,  bpmstripline,  QWK_BPM3H09BYM
   VQWK, 4, 5,  bcm,  QWK_6V_battery
   VQWK, 4, 6,  bcm,  QWK_BCM2              
   VQWK, 4, 7,  bcm,  QWK_BCM1    


!ADC5, Slot 8,  Serial Number 32, Address 0x80
   VQWK, 5, 0,  bpmstripline,  QWK_BPM3C07XP
   VQWK, 5, 1,  bpmstripline,  QWK_BPM3C07XM
   VQWK, 5, 2,  bpmstripline,  QWK_BPM3C07YP
   VQWK, 5, 3,  bpmstripline,  QWK_BPM3C07YM
   VQWK, 5, 4,  bpmstripline,  QWK_BPM3C08XP
   VQWK, 5, 5,  bpmstripline,  QWK_BPM3C08XM
   VQWK, 5, 6,  bpmstripline,  QWK_BPM3C08YP
   VQWK, 5, 7,  bpmstripline,  QWK_BPM3C08YM

!ADC6, Slot 9,  Serial Number 04, Address 0x81
   VQWK, 6, 0,  bpmstripline,  QWK_BPM3C11XP
   VQWK, 6, 1,  bpmstripline,  QWK_BPM3C11XM
   VQWK, 6, 2,  bpmstripline,  QWK_BPM3C11YP
   VQWK, 6, 3,  bpmstripline,  QWK_BPM3C11YM
   VQWK, 6, 4,  bpmstripline,  QWK_BPM3C12XP
   VQWK, 6, 5,  bpmstripline,  QWK_BPM3C12XM
   VQWK, 6, 6,  bpmstripline,  QWK_BPM3C12YP
   VQWK, 6, 7,  bpmstripline,  QWK_BPM3C12YM

!ADC7, Slot 10, Serial Number 31, Address0x82
   VQWK, 7, 0,  bpmstripline,  QWK_BPM3C14XP
   VQWK, 7, 1,  bpmstripline,  QWK_BPM3C14XM
   VQWK, 7, 2,  bpmstripline,  QWK_BPM3C14YP
   VQWK, 7, 3,  bpmstripline,  QWK_BPM3C14YM
   VQWK, 7, 4,  bpmstripline,  QWK_BPM3C16YM
   VQWK, 7, 5,  bpmstripline,  QWK_BPM3C16YP
   VQWK, 7, 6,  bpmstripline,  QWK_BPM3C16XM
   VQWK, 7, 7,  bpmstripline,  QWK_BPM3C16XP

!ADC8, Slot 11, Serial Number 20, Address 0x83
   VQWK, 8, 0,  bpmstripline,  QWK_BPM3C17XP
   VQWK, 8, 1,  bpmstripline,  QWK_BPM3C17XM
   VQWK, 8, 2,  bpmstripline,  QWK_BPM3C17YP
   VQWK, 8, 3,  bpmstripline,  QWK_BPM3C17YM
   VQWK, 8, 4,  bpmstripline,  QWK_BPM3C18XP
   VQWK, 8, 5,  bpmstripline,  QWK_BPM3C18XM
   VQWK, 8, 6,  bpmstripline,  QWK_BPM3C18YP
   VQWK, 8, 7,  bpmstripline,  QWK_BPM3C18YM

!ADC9, Slot 12, Serial Number 30, Address 0x84
   VQWK, 9, 0,  bpmstripline,  QWK_BPM3C19XP
   VQWK, 9, 1,  bpmstripline,  QWK_BPM3C19XM
   VQWK, 9, 2,  bpmstripline,  QWK_BPM3C19YP
   VQWK, 9, 3,  bpmstripline,  QWK_BPM3C19YM
   VQWK, 9, 4,  bpmstripline,  QWK_BPM3C07AXP
   VQWK, 9, 5,  bpmstripline,  QWK_BPM3C07AXM
   VQWK, 9, 6,  bpmstripline,  QWK_BPM3C07AYP
   VQWK, 9, 7,  bpmstripline,  QWK_BPM3C07AYM

!ADC10, Slot 13, Serial Number 29, Address 0x85	
   VQWK, 10, 0,  bpmstripline,  QWK_BPM3P02AXP
   VQWK, 10, 1,  bpmstripline,  QWK_BPM3P02AXM
   VQWK, 10, 2,  bpmstripline,  QWK_BPM3P02AYP
   VQWK, 10, 3,  bpmstripline,  QWK_BPM3P02AYM
   VQWK, 10, 4,  bpmstripline,  QWK_BPM3P02BXP
   VQWK, 10, 5,  bpmstripline,  QWK_BPM3P02BXM
   VQWK, 10, 6,  bpmstripline,  QWK_BPM3P02BYP
   VQWK, 10, 7,  bpmstripline,  QWK_BPM3P02BYM

!ADC11, Slot 14, Serial Number 01, Address 0x86
   VQWK, 11, 0,  bpmstripline,  QWK_BPM3P03AXP
   VQWK, 11, 1,  bpmstripline,  QWK_BPM3P03AXM
   VQWK, 11, 2,  bpmstripline,  QWK_BPM3P03AYP
   VQWK, 11, 3,  bpmstripline,  QWK_BPM3P03AYM
   VQWK, 11, 4,  bpmstripline,  QWK_BPM3C20XP
   VQWK, 11, 5,  bpmstripline,  QWK_BPM3C20XM
   VQWK, 11, 6,  bpmstripline,  QWK_BPM3C20YP
   VQWK, 11, 7,  bpmstripline,  QWK_BPM3C20YM

!ADC12, Slot 15, Serial Number 05, Address 0x87
   VQWK, 12, 0,  bpmstripline,  QWK_BPM3C21XP
   VQWK, 12, 1,  bpmstripline,  QWK_BPM3C21XM
   VQWK, 12, 2,  bpmstripline,  QWK_BPM3C21YP
   VQWK, 12, 3,  bpmstripline,  QWK_BPM3C21YM
   VQWK, 12, 4,  bpmstripline,  QWK_BPM3H02XP
   VQWK, 12, 5,  bpmstripline,  QWK_BPM3H02XM
   VQWK, 12, 6,  bpmstripline,  QWK_BPM3H02YP
   VQWK, 12, 7,  bpmstripline,  QWK_BPM3H02YM
          

!**************************************************************************
! HALL C PHASE MONITOR
!**************************************************************************
ROC=0
Bank=0x6110

!ADC0
   VQWK, 0, 0,  bcm,  QWK_LINEPHASE
   VQWK, 0, 1,  bcm,  QWK_INVERT_TStable
   VQWK, 0, 2,  raster,  QWK_RASTER_X
   VQWK, 0, 3,  raster,  QWK_RASTER_Y
   VQWK, 0, 4,  raster,  QWK_RASTER_SUMXY
!
!  see Analysis/prminput/qweak_scanner_channel.map 
!   VQWK, 0, 5,  scanner,  QWK_SCANNER_POSX
!   VQWK, 0, 6,  scanner,  QWK_SCANNER_POSY
!   VQWK, 0, 7,  scanner,  QWK_SCANNER_POW
	


!
!
!**************************************************************************
! HALL C BEAMLINE SCALERS
!**************************************************************************

normclock=sca_4MHz

Bank=0x6103
!
!! scaler.type, scaler.num  word.num, det.type, det.name


   SCALER, 0, 16, bcm, sca_bcm1
   SCALER, 0, 17, bcm, sca_bcm2
   SCALER, 0, 18, bcm, sca_bcm17
   SCALER, 0, 19, bcm, sca_unser	
   !!  
   SCALER, 0, 22, bcm, sca_habcm


   SCALER, 0, 29, clock, sca_31MHz
   SCALER, 0, 30, clock, sca_4MHz
   SCALER, 0, 31, clock, sca_20MHz

   SCALER, 2, 18, halomonitor, sca_halo3
   SCALER, 2, 19, halomonitor, sca_halo4
   SCALER, 2, 20, halomonitor, sca_halo5
   SCALER, 2, 21, halomonitor, sca_halo6
   SCALER, 2, 22, halomonitor, sca_halo7
   SCALER, 2, 24, halomonitor, sca_halo8
   SCALER, 2, 25, halomonitor, sca_halo9
   SCALER, 2, 26, halomonitor, sca_halo10



!**************************************************************************
! COMBINATIONS OF BEAM LINE DEVICES USED FOR BEAM ON TARGET 
!**************************************************************************
!
! Enter the device names in order they appear in the beamline.
!
begin=combinedbcm
name=qwk_charge
!name	   type	 wieght
  qwk_bcm8,  bcm, 1.0
end=combinedbcm

begin=combinedbpm
name=qwk_target	
!name           type          q      x          y    
 QWK_BPM3H07A,  bpmstripline, 1.0,   1.0,   1.0 
 QWK_BPM3H07B,  bpmstripline, 1.0,   1.0,   1.0
 QWK_BPM3H07C,  bpmstripline, 1.0,   1.0,   1.0
 QWK_BPM3H09,   bpmstripline, 1.0,   1.0,   1.0
! QWK_BPM3H09B,  bpmstripline, 1.0,   1.0,   1.0
end=combinedbpm

!New qwk_target including 3h04
begin=combinedbpm
name=qwk_target_plus4	
! name           type          q      x          y    
  QWK_BPM3H04,   bpmstripline, 1.0,   1.0,   1.0
  QWK_BPM3H07A,  bpmstripline, 1.0,   1.0,   1.0 
  QWK_BPM3H07B,  bpmstripline, 1.0,   1.0,   1.0
  QWK_BPM3H07C,  bpmstripline, 1.0,   1.0,   1.0
  QWK_BPM3H09,   bpmstripline, 1.0,   1.0,   1.0
!  QWK_BPM3H09B,  bpmstripline, 1.0,   1.0,   1.0
end=combinedbpm

! The X and Y weights were obtained using run 10220 at 150uA.


!**************************************************************************
! COMBINATION OF DEVICES USED TO OBTAIN THE BEAM ENERGY
!**************************************************************************
! For the energy calculation we need the following inforamtion. 
! 	Beam position at the highest dispersive region (beamposition)
!	Beam angle on target (targetbeamangle)
!	Beam position on target (targetbeamposition)
! 	The ratios of the TMatrix elements (with the appropriate signs).
! These are used in the equation
!	(dP/P) = (1/M15)*X_3c12 + (-M11/M15)*X_T + (-M12/M15)*X_T`
! To get (dP/P).

begin=energycalculator
name=qwk_energy
! name      type 	  ratios property  
 qwk_bpm3c12, bpmstripline,  0.00024, beamposition 
 qwk_target,  combinedbpm,  -0.00017, targetbeamposition	  
 qwk_target,  combinedbpm,   2.6, targetbeamangle
end=energycalculator

! CHECK THE SIGNS OF THE MATRIX ELEMENT RATIOS!. Since M11 and M12 are
! negative you have to USE the NEGATIVE sign for the ratios.


!END

!set of published variables
!publish name,device_type, device name, property (x-pos,xp-angle,y-pos,yp-angle,c-charge,e-energy change, ef - effective charge)

!Each line must contain,
!1. publish name
!2. device type
!	bcm
!	bpmstrpline
!	bpmcavity
!	combobpm
!	combobcm
!	comboenergy
!3. device name 
!4. property to publish
!	x-pos
!	xp-angle
!	y-pos
!	yp-angle
!	c-charge
!	e-energy change
!	ef-effective charge

[PUBLISH]
 q_targ, combobcm, qwk_charge, c
 x_targ, combobpm, qwk_target, x
 y_targ, combobpm,  qwk_target, y
 xp_targ, combobpm,  qwk_target, xp
 yp_targ, combobpm,  qwk_target, yp
 e_targ, comboenergy,  qwk_energy, e
 qwk_3c16_effectivecharge, bpmstripline, qwk_bpm3c16, ef

